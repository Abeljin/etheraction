<!DOCTYPE html><html class="no-js"><head lang="zh-cn"><meta charset="utf-8"><meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1"><meta http-equiv="X-UA-Compatible" content="IE=10"><title>源文件布局 - 精通以太坊</title><meta name="generator" content="Hugo 0.31.1"><meta name="description" content="从零成长为以太坊高级开发者"><link rel="canonical" href="https://ether.goall.top/solidity/doc/depth/layout-of-source-files.html"><meta name="author" content="虞双齐"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="renderer" content="webkit"><meta name="applicable-device" content="pc,mobile"><meta name="MobileOptimized" content="width"><meta name="HandheldFriendly" content="true"><meta name="mobile-web-app-capable" content="yes"><link rel="icon" sizes="32x32" href="https://ether.goall.top/images/favicon.ico"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="apple-mobile-web-app-title" content="精通以太坊"><link rel="apple-touch-icon-precomposed" href="https://ether.goall.top/images/app-icon64x64.png"><meta name="msapplication-TileImage" content="/images/app-icon128x128.png"><meta name="msapplication-TileColor" content="#0e90d2"><meta property="og:url" content="https://ether.goall.top/solidity/doc/depth/layout-of-source-files.html"><meta property="og:title" content="精通以太坊"><meta property="og:image" content="https://ether.goall.top/images/logo.png"><meta name="apple-mobile-web-app-title" content="精通以太坊"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><link rel="shortcut icon" type="image/x-icon" href="https://ether.goall.top/images/favicon.ico"><link rel="icon" type="image/x-icon" href="https://ether.goall.top/images/favicon.ico"><style>@font-face{font-family:Icon;src:url(https://ether.goall.top/fonts/icon.eot);src:url(https://ether.goall.top/fonts/icon.eot) format('embedded-opentype'),url(https://ether.goall.top/fonts/icon.woff) format('woff'),url(https://ether.goall.top/fonts/icon.ttf) format('truetype'),url(https://ether.goall.top/fonts/icon.svg) format('svg');font-weight:400;font-style:normal}</style><link rel="stylesheet" href="https://ether.goall.top/stylesheets/application.css"><link rel="stylesheet" href="https://ether.goall.top/stylesheets/temporary.css"><link rel="stylesheet" href="https://ether.goall.top/stylesheets/palettes.css"><link rel="stylesheet" href="https://ether.goall.top/stylesheets/highlight/highlight.css"><link rel="stylesheet" href="//fonts.cat.net/css?family=Noto%20Sans%20CJK:400,700|Ubuntu&#43;Mono"><style>body,input{font-family:'Noto Sans CJK',Helvetica,Arial,sans-serif}code,pre{font-family:'Ubuntu Mono','Courier New',Courier,monospace}</style><script src="https://ether.goall.top/javascripts/modernizr.js"></script></head><body class="palette-primary-green palette-accent-teal"><div class="backdrop"><div class="backdrop-paper"></div></div><input class="toggle" type="checkbox" id="toggle-drawer"> <input class="toggle" type="checkbox" id="toggle-search"><label class="toggle-button overlay" for="toggle-drawer"></label><header class="header"><nav aria-label="Header"><div class="bar default"><div class="button button-menu" role="button" aria-label="Menu"><label class="toggle-button icon icon-menu" for="toggle-drawer"><span></span></label></div><div class="stretch"><div class="title">源文件布局</div></div><div class="button button-github" role="button" aria-label="GitHub"><a href="https://github.com/ysqi" title="@ysqi on GitHub" target="_blank" class="toggle-button icon icon-github"></a></div></div><div class="bar search"><div class="button button-close" role="button" aria-label="Close"><label class="toggle-button icon icon-back" for="toggle-search"></label></div><div class="stretch"><div class="field"><input class="query" type="text" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck></div></div><div class="button button-reset" role="button" aria-label="Search"><button class="toggle-button icon icon-close" id="reset-search"></button></div></div></nav></header><main class="main"><div class="drawer"><nav aria-label="Navigation"><a href="https://github.com/ysqi/etheraction" class="project"><div class="banner"><div class="logo"><img src="https://ether.goall.top/images/logo.png"></div><div class="name"><strong>精通以太坊 <span class="version">1.0.0</span></strong><br>ysqi/etheraction</div></div></a><div class="scrollable"><div class="wrapper"><ul class="repo"><li class="repo-download"><a href="https://github.com/ysqi/etheraction/archive/master.zip" target="_blank" title="Download" data-action="download"><i class="icon icon-download"></i> Download</a></li><li class="repo-stars"><a href="https://github.com/ysqi/etheraction/stargazers" target="_blank" title="Stargazers" data-action="star"><i class="icon icon-star"></i> Stars <span class="count">&ndash;</span></a></li></ul><hr><div class="toc"><ul><li><a title="前言" href="https://ether.goall.top/">前言</a></li><li><a title="第一章 基础知识" href="https://ether.goall.top/basic/">第一章 基础知识</a></li><li><a title="第二章 智能合约" href="https://ether.goall.top/contract/">第二章 智能合约</a></li><li><span class="section">第三章 Solidify 官方文档中译版</span><ul><a title="简介" href="https://ether.goall.top/solidity/doc/">简介 </a><a title="智能合约介绍" href="https://ether.goall.top/solidity/doc/introduction-to-smart-contracts.html">智能合约介绍 </a><a title="安装 Solidity" href="https://ether.goall.top/solidity/doc/installing-solidity.html">安装 Solidity </a><a title="Solidity 示例" href="https://ether.goall.top/solidity/doc/solidity-by-example.html">Solidity 示例 </a><a title="深入了解 Solidity" href="https://ether.goall.top/solidity/doc/depth/">深入了解 Solidity</a><ul><a class="current" title="源文件布局" href="https://ether.goall.top/solidity/doc/depth/layout-of-source-files.html">源文件布局</a><ul id="scrollspy"></ul></ul></ul></li><li><a title="第四章 实战" href="https://ether.goall.top/action">第四章 实战</a></li><li><a title="license" href="https://ether.goall.top/license">license</a></li></ul><hr><span class="section">The author</span><ul><li><a href="https://github.com/ysqi" target="_blank" title="@ysqi on GitHub">@ysqi on GitHub</a></li><li><a href="mailto:devysq@gmail.com" title="Email of devysq@gmail.com">Contact via email</a></li></ul></div></div></div></nav></div><article class="article"><div class="wrapper"><h1>源文件布局</h1><p>源文件中可以定义任意个合约(contract)、嵌入(inlucde)和杂注(pragma)指令。</p><h2 id="版本杂注">版本杂注</h2><p>源文件中能够(也应该)用所谓版本杂注，以便拒绝被含有不兼容性变更的高版本编译器所编译。 我们尽量保持最小变更，特别是语义变化而引起语法变更的，但这总不可能避免。因此，对于有重大变化的新版本，通读更新日志是一个不错的建议。大版本的版本号始终是 <code>0.x.0</code>或者 <code>x.0.0</code> 形式。</p><p>版本杂注使用方式如下：</p><pre><code class="language-js">pragma solidity ^0.4.0;
</code></pre><p>这样的源文件将不会使用低于版本 0.4.0 的编译器编译，也不适用于从 0.5.0 开始的编译器（被 <code>^</code> 限制）。 这做法背后的思想是，在版本 0.5.0 之前不会有任何重大改变，所以我们可确保代码始终按照我们的意愿进行编译。我们没有修复编译器的确切版本，因此补丁版仍然是有可能的。</p><p>可以为编译器指定更复杂的编译规则，指令表达式遵循 <a href="https://docs.npmjs.com/misc/semver">npm</a> 版本语义。</p><h2 id="导入其他源文件">导入其他源文件</h2><h3 id="语法与语义">语法与语义</h3><p>Solidity 支持导入语句。尽管 Solidity 还不能知道 &ldquo;default export&rdquo; 的概念，但已经 非常类似 JavaScript 用法（从 ES6 起）。</p><p>在全局级上，你可使用下面格式使用导入语句：</p><pre><code class="language-js">import &quot;filename&quot;;
</code></pre><p>此语句将从 filename 中导入所有的全局符号到到当前全局域中（不同于 ES6 但 Solidity 是向后兼容）。</p><pre><code class="language-js">import * as symbolName from &quot;filename&quot;;
</code></pre><p>&hellip;&hellip;创建一个新全局符号 <code>symbolName</code>，成员均是来自 <code>&quot;filename&quot;</code> 中全局符号。</p><pre><code class="language-js">import {symbol1 as alias, symbol2} from &quot;filename&quot;;
</code></pre><p>&hellip;&hellip;创建新全局符号 <code>alias</code> 和 <code>symbol2</code>。<code>symbol1</code>和<code>symbol2</code>分别从 <code>&quot;filename&quot;</code>引入。</p><p>另外一种语法不属于 ES6，但或许是便利的：</p><pre><code class="language-js">import &quot;filename&quot; as symbolName;
</code></pre><p>此等同于 <code>import * as symbolName from &quot;filename&quot;;</code>.</p><h3 id="路径">路径</h3><p>在上面，<code>filename</code> 始终被视为以 <code>/</code> 作为目录分割符的文件路径。<code>.</code>表示当前目录，<code>..</code>表示父目录。 当 <code>.</code> 或 <code>..</code> 后面跟随的是非<code>/</code>字符时，不作为当前或父目录对待。除非以当前目录<code>.</code>或者父目录<code>..</code>开头，所有路径名均被视为绝对路径。</p><p>用 <code>import &quot;./x&quot; as x;</code> 语句导入当前源文件同目录下的文件<code>x</code>。 如果你使用<code>import &quot;x&quot; as x;</code>，相反，会有一个不同的文件(在全局 <code>include directory</code>范围内)被引入。</p><p>路径取决于编译器（见下）如何真实解析。通常，目录层次不必严格映射到你的本地文件系统，它也可以映射到资源发现，如 ipfs，http 或者 git。</p><h2 id="使用真正的编译器">使用真正的编译器</h2><p>当编译器被调用后，它不仅能规定如何发现路径的第一个元素，还可规定路径前景重映射。例如 <code>github.com/ethereum/dapp-bin/library</code> 重映射到<code>/usr/local/dapp-bin/library</code> 且编译器也将从这里读取文件。如果多个重映射被规定，优先尝试 key 最长的一个。 还允许规定”回退映射“，例如，<code>&quot;&quot;</code>映射到 <code>&quot;/usr/local/include/solidity&quot;</code>。此外，这些重映射可依赖于上下文，以允许你配置要所导入的包，例如，同一个库名的不同版本。</p><p><strong>solc</strong>:</p><p>solc（命令行编译器），这些重映射以 <code>context:prefix=target</code> 参数形式提供。 <code>context</code>必须有，<code>=target</code>可选（此时 target 默认为 prefix）。所有重映射的常规文件都被编译（包括他们的依赖）。此机制完全向后兼容（只要没文件名包含 = 或 :），因此不会是一个破坏性变更。在 <code>content</code> 目录下或之下的，所有以 <code>prefix</code> 开头的文件都将被用 <code>target</code> 替换 <code>prefix</code> 来重定向。</p><p>举个例子，如果你克隆 <code>github.com/ethereum/dapp-bin/</code> 到本地 <code>/usr/local/dapp-bin</code>，你可在源文件中如下使用：</p><pre><code class="language-js">import &quot;github.com/ethereum/dapp-bin/library/iterable_mapping.sol&quot; as it_mapping;
</code></pre><p>再运行编译器:</p><pre><code class="language-bash">solc github.com/ethereum/dapp-bin/=/usr/local/dapp-bin/ source.sol
</code></pre><p>作为一个更复杂的例子，假设你依赖一个非常旧版本的 dapp-bin 上的一些模块。 旧版本 dapp-bin 签出到<code>/usr/local/dapp-bin_old</code>, 那么你可使用：</p><pre><code class="language-bash">solc module1:github.com/ethereum/dapp-bin/=/usr/local/dapp-bin/ \
     module2:github.com/ethereum/dapp-bin/=/usr/local/dapp-bin_old/ \
    source.sol
</code></pre><p>以便 <code>module2</code> 下所有导入都指向旧版本，而 <code>module1</code> 指向新版本。</p><p>注意， solc 只允许你包含来自某些目录的文件：目录（或子目录）可以是明确指定源文件的目录之一，或重映射目标路径。如果你想指向绝对路径，只需重映射为 <code>=/</code>。</p><p>如果有多个重映射指向一个有效文件，那选择最长公共前缀的重映射。</p><p><strong>Remix</strong>:</p><p><a href="https://remix.ethereum.org/">Remix</a> 提供了一个为 github 的自动重映射，将通过网络自动获取文件。你可从导入一个键迭代器，如：<code>import &quot;github.com/ethereum/dapp-bin/library/iterable_mapping.sol&quot; as it_mapping;</code>。</p><p>可能在未来支持其他源码平台。</p><h2 id="注释">注释</h2><p>可单行注释(<code>//</code>)和多行注释(<code>/*...*/</code>)</p><pre><code class="language-js">// This is a single-line comment.

/*
This is a
multi-line comment.
*/
</code></pre><p>此外，有另一种注释称为 natspec 注释，其文档尚未编写。 它们用三扛（<code>///</code>）或双星块(<code>/** ... */</code>)编辑，它应直接在方法声明或语句上使用。你可在注释中使用 <a href="https://en.wikipedia.org/wiki/Doxygen">Doxygen</a>样式的标签来文档化方法，解释正常验证的条件。并提供一个 <strong>确认信息</strong>，可在用户尝试调用一个方法时提示。</p><p>下面示例，我们记录合约标题和解释两个入参、两个返回值。</p><p>In the following example we document the title of the contract, the explanation for the two input parameters and two returned values.</p><pre><code class="language-js">pragma solidity ^0.4.0;

/** @title Shape calculator. */
contract shapeCalculator {
    
    /** @dev Calculates a rectangle's surface and perimeter.
      * @param w Width of the rectangle.
      * @param h Height of the rectangle.
      * @return s The calculated surface.
      * @return p The calculated perimeter.
      */
    function rectangle(uint w, uint h) returns (uint s, uint p) {
        s = w * h;
        p = 2 * (w + h);
    }
}
</code></pre><aside class="copyright" role="note">&copy; 2018 根据Apache 2.0 许可发布 &ndash; 文档基于 <a href="https://www.gohugo.io" target="_blank">Hugo</a>， 使用 <a href="https://github.com/ysqi/hugo-material-docs.git" target="_blank">Material</a> 主题构建.</aside><footer class="footer"><nav class="pagination" aria-label="Footer"><div class="previous"><a href="https://ether.goall.top/solidity/doc/depth/" title="深入了解 Solidity"><span class="direction">Previous</span><div class="page"><div class="button button-previous" role="button" aria-label="Previous"><i class="icon icon-back"></i></div><div class="stretch"><div class="title">深入了解 Solidity</div></div></div></a></div><div class="next"><a href="https://ether.goall.top/action/" title="实战"><span class="direction">Next</span><div class="page"><div class="stretch"><div class="title">实战</div></div><div class="button button-next" role="button" aria-label="Next"><i class="icon icon-forward"></i></div></div></a></div></nav></footer></div></article><div class="results" role="status" aria-live="polite"><div class="scrollable"><div class="wrapper"><div class="meta"></div><div class="list"></div></div></div></div></main><script>var base_url = 'https:\/\/ether.goall.top';
      var repo_id  = 'ysqi\/etheraction';</script><script src="https://ether.goall.top/javascripts/application.js"></script><script>/* Add headers to scrollspy */
      var headers   = document.getElementsByTagName("h2");
      var scrollspy = document.getElementById('scrollspy');

      if(scrollspy) {
        if(headers.length > 0) {
          for(var i = 0; i < headers.length; i++) {
            var li = document.createElement("li");
            li.setAttribute("class", "anchor");

            var a  = document.createElement("a");
            a.setAttribute("href", "#" + headers[i].id);
            a.setAttribute("title", headers[i].innerHTML);
            a.innerHTML = headers[i].innerHTML;

            li.appendChild(a)
            scrollspy.appendChild(li);
          }
        } else {
          scrollspy.parentElement.removeChild(scrollspy)
        }


        /* Add permanent link next to the headers */
        var headers = document.querySelectorAll("h1, h2, h3, h4, h5, h6");

        for(var i = 0; i < headers.length; i++) {
            var a = document.createElement("a");
            a.setAttribute("class", "headerlink");
            a.setAttribute("href", "#" + headers[i].id);
            a.setAttribute("title", "Permanent link")
            a.innerHTML = "#";
            headers[i].appendChild(a);
        }
      }</script><script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.8.0/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script></body></html>